let completed_fields=[],closePopup=()=>{var e,a=document.querySelector(".partner-popup-wrapper");a&&(a.remove(),a=document.documentElement,e=document.body,a.style.overflow="",e.style.overflow="",wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")),completed_fields=[]},wpEditorSettings=()=>({tinymce:!0,quicktags:!1,mediaButtons:!1}),popupCronogramaInit=()=>{var e=document.querySelectorAll(".partner-trigger-popup");let n=document.documentElement,d=document.body;for(let o of e)o.addEventListener("click",e=>{e.preventDefault(),n.style.overflow="hidden",d.style.overflow="hidden",closePopup();var e=o.dataset.partnerPopupId,e=document.querySelector("#"+e).innerHTML,a=document.createElement("div"),e=(a.classList.add("popup-content"),a.id="popup-content",a.innerHTML=e,document.createElement("div")),a=(e.classList.add("partner-popup"),e.appendChild(a),document.createElement("a")),t=(a.classList.add("partner-popup-close"),a.innerHTML="&times;",e.appendChild(a),document.createElement("div"));t.classList.add("partner-popup-wrapper"),t.appendChild(e),document.body.insertBefore(t,document.body.firstChild),a.addEventListener("click",()=>{closePopup()}),t.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&closePopup()})})},popupChamadosInit=()=>{var a;for(a of document.querySelectorAll(".partner-trigger-popup-chamados")){let e="";e="A"===a.tagName?a:a.querySelector("a"),clickEventChamado(e)}},clickEventChamado=a=>{a.addEventListener("click",e=>{e.preventDefault(),triggerPopupChamados(a)})},changeSortSelect=()=>{var a=document.querySelector(".jet-sorting-select");if(null!=a){var t=a.value,o=a.options;let e=null;var n=a.dataset.oldValue;if("opened"===a.dataset.popupStatus)a.setAttribute("data-popup-status","closed"),e=n;else{a.setAttribute("data-popup-status","opened"),a.setAttribute("data-old-value",t);for(var d of o)if(d.value!==t){e=d.value;break}}a.value=e,a.dispatchEvent(new Event("change"))}},triggerPopupChamados=function(e,a=null){closePopup(),changeSortSelect();var t=document.createElement("div"),o=(t.classList.add("partner-popup"),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",t.appendChild(o),document.createElement("div")),d=(n.classList.add("popup-content"),n.id="popup-content",document.createElement("div")),d=(d.id="loading",d.classList.add("loading"),d.textContent="Carregando...",n.appendChild(d),t.appendChild(n),document.createElement("div")),d=(d.classList.add("partner-popup-wrapper"),d.appendChild(t),document.body.insertBefore(d,document.body.firstChild),setAHrefToOpenInNewTab(),document.documentElement),l=document.body;d.style.overflow="hidden",l.style.overflow="hidden",o.addEventListener("click",()=>{closePopup(),changeSortSelect()}),partner_get_chamado(e,a,t,n)},partner_get_chamado=(t,o,n,d)=>{let l=new XMLHttpRequest;var e=o?"post_id="+o:"";l.responseType="json",l.open("POST",ajax_object.ajax_url+"?action=partner_get_chamado&"+e),l.onload=function(){var e,a=l.response;200===l.status&&(a.success?(null!=(e=document.getElementById("loading"))&&e.remove(),("view"===t?partner_view_chamado:partner_set_chamado_form)(a,o,n,d),e=wpEditorSettings(),wp.editor.initialize("chamado-detalhamento-solicitacao",e),wp.editor.initialize("chamado-detalhamento-resolucao",e),setAHrefToOpenInNewTab()):console.log(a))},l.send()},partner_view_chamado=(d,e,l,c)=>{if(void 0===d.chamado||null===d.chamado)console.log(d);else{var r,i=d.chamado,m=parseInt(i.cliente);for(r of d.clientes)r.ID===m&&0;var s,p=parseInt(i.urgencia);let e=null;for(s of d.urgencias)s.term_id===p&&(e=s);var u,h=parseInt(i.status);let a=null;for(u of d.status)u.term_id===h&&(a=u);var v,g=parseInt(i.etapa);let t=null;for(v of d.etapas)v.term_id===g&&(t=v);var d=i.profissional.name,f=i.sucesso_cliente.name,E=i.contato_emergencia.name,C=(c.classList.add("chamado-view"),document.createElement("aside")),_=(C.id="chamado-aside",C.classList.add("chamado-aside"),document.createElement("div")),L=(_.id="chamado-aside-column-1",_.classList.add("chamado-aside-column"),document.createElement("div")),L=(L.classList.add("chamado-id"),L.innerHTML=`<h3>#${i.id}</h3>`,_.appendChild(L),document.createElement("div")),L=(L.classList.add("chamado-marca"),L.innerHTML=`<h5>Marca</h5><h3>${i.marca}</h3>`,_.appendChild(L),document.createElement("div")),L=(L.classList.add("chamado-assunto"),L.innerHTML=`<h5>Assunto</h5><h3>${i.assunto}</h3>`,_.appendChild(L),C.appendChild(_),document.createElement("div")),_=(L.id="chamado-aside-column-2",L.classList.add("chamado-aside-column"),document.createElement("div")),y=(_.classList.add("chamado-data-solicitacao"),new Date(i.data_solicitacao));let o=y.toLocaleString("pt-BR",{month:"short"});o=o.slice(0,-1);var b=y.getDate(),y=y.toLocaleString("pt-BR",{hour:"numeric",minute:"numeric"}),b=(_.innerHTML=`<h5>Data da Solicitação</h5><p><span class="dia">${b}</span><span class="mes">${o}</span><span class="hora">${y}</span></p>`,L.appendChild(_),document.createElement("div")),y=(b.classList.add("chamado-previsao-entrega"),new Date(i.data_entrega));let n=y.toLocaleString("pt-BR",{month:"short"});n=n.slice(0,-1);_=y.getDate(),y=y.toLocaleString("pt-BR",{hour:"numeric",minute:"numeric"}),_=(b.innerHTML=`<h5>Previsão de entrega</h5><p><span class="dia">${_}</span><span class="mes">${n}</span><span class="hora">${y}</span></p>`,L.appendChild(b),C.appendChild(L),document.createElement("div")),y=(_.id="chamado-aside-column-3",_.classList.add("chamado-aside-column"),document.createElement("div")),b=(y.classList.add("chamado-urgencia"),y.innerHTML=`
    <h5>Tags:</h5>
    <ul class="chamado-tags">
    <li><span class="chamado-label" style="background-color: ${e.cor}">${e.name}</span></li>
    <li><span class="chamado-label" style="background-color: ${a.cor}">${a.name}</span></li>
    </ul>`,_.appendChild(y),C.appendChild(_),c.appendChild(C),document.createElement("div")),L=(b.id="chamado-content",b.classList.add("chamado-content"),document.createElement("p")),y=(L.classList.add("chamado-detalhamento-solicitacao-title"),L.innerHTML="<h5>Solicitação</h5>",b.appendChild(L),document.createElement("div")),_=(y.classList.add("chamado-detalhamento-solicitacao-text"),y.innerHTML=i.detalhamento_solicitacao,b.appendChild(y),document.createElement("p")),C=(_.classList.add("chamado-detalhamento-resolucao-title"),_.innerHTML="<h5>Resolução</h5>",b.appendChild(_),document.createElement("div")),_=(C.classList.add("chamado-detalhamento-resolucao-text"),C.innerHTML=i.detalhamento_resolucao,b.appendChild(C),d&&((L=document.createElement("div")).classList.add("chamado-profissional"),L.innerHTML=`<h5>Profissional</h5><p>${d}</p>`,b.appendChild(L)),t&&((y=document.createElement("div")).classList.add("chamado-etapa"),y.innerHTML=`<h5>Etapa</h5><p>${t.name}</p>`,b.appendChild(y)),document.createElement("div")),i=(_.classList.add("chamado-ponto-focal"),document.createElement("h5")),C=(i.innerHTML="Ponto Focal",_.appendChild(i),document.createElement("p"));C.innerHTML=f+`, ${E}.`,_.appendChild(C),b.appendChild(_),c.appendChild(b),l.appendChild(c)}},partner_set_chamado_form=(a,d,l,c)=>{let t=parseInt(a.cliente),o=a.marca,r=document.createElement("form");r.id="partner-chamado-form",r.classList.add("partner-chamado-form");let e;var n=a.clientes;if(null===d){e=document.createElement("select");var i,m=document.createElement("option");m.value="",m.innerHTML="Selecione um cliente",e.appendChild(m);for(i of n){var s=document.createElement("option");s.value=i.ID,s.innerHTML=i.post_title,t===i.ID&&(s.selected=!0),e.appendChild(s)}}else{(e=document.createElement("input")).type="hidden",e.value=t;var p,u=document.createElement("h4");for(p of n)t===p.ID&&(u.textContent=p.post_title+" #"+a.chamado.id);r.appendChild(u)}e.id="partner-chamado-cliente",e.name="partner-chamado-cliente",r.appendChild(e),t&&partner_set_marcas_options(a,t,t,o,r),"SELECT"===e.tagName&&e.addEventListener("change",function(){var e=document.getElementById("partner-chamado-marca"),e=(null!==e&&e.remove(),removeChamadoInputs(),this.value);partner_set_marcas_options(a,t,e,o,r)}),r.addEventListener("submit",function(e){e.preventDefault(),tinyMCE.triggerSave();var a,t;let o=null;for([a,t]of new FormData(r).entries()){var n=document.getElementById(a);n.classList.remove("error"),a,"chamado-detalhamento-solicitacao"===a||"chamado-detalhamento-resolucao"===a||t||(o=!0,n.classList.add("error"))}o||((e=document.createElement("div")).id="loading",e.classList.add("loading"),e.textContent="Processando...",c.insertBefore(e,c.firstChild),partner_save_chamado(d,r,l))}),c.appendChild(r),l.appendChild(c)},partner_set_marcas_options=(a,t,o,n,d)=>{var e=a.marcas;let l=document.createElement("select"),c=null;if(l.id="partner-chamado-marca",l.name="partner-chamado-marca",o){var r,e=e[o],i=document.createElement("option");i.value="",i.textContent="Selecione uma marca",l.appendChild(i);for(r of e){var m=document.createElement("option");m.textContent=r,m.value=r,n===r&&(m.selected=!0),l.appendChild(m)}l.addEventListener("change",()=>{var e;removeChamadoInputs(),(c=l.value)&&(addChamadoInputs(a,t,o,n,c,d),e=wpEditorSettings(),wp.editor.initialize("chamado-detalhamento-solicitacao",e),wp.editor.initialize("chamado-detalhamento-resolucao",e))}),d.appendChild(l),parseInt(t)===parseInt(o)&&(c=n,addChamadoInputs(a,t,o,n,c,d,!0))}},addChamadoInputs=(e,a,t,o,n,d,l=!1)=>{var c,r=e.urgencias,i=e.status,m=e.users,s=e.etapas,p=document.createElement("input"),u=(p.type="text",p.name="chamado-assunto",p.id="chamado-assunto",p.className="chamado-input",p.placeholder="Assunto",p.required=!0,document.createElement("label")),h=(u.id="chamado-detalhamento-solicitacao-label",u.htmlFor="chamado-detalhamento-solicitacao",u.innerText="Detalhamento da solicitação",document.createElement("textarea")),v=(h.name="chamado-detalhamento-solicitacao",h.id="chamado-detalhamento-solicitacao",h.className="chamado-textarea",h.placeholder="Detalhamento da Solicitação",h.rows="5",u.appendChild(h),document.createElement("label")),g=(v.id="chamado-data-solicitacao-label",v.htmlFor="chamado-data-solicitacao",v.innerText="Data da solicitação",document.createElement("input")),f=(g.name="chamado-data-solicitacao",g.id="chamado-data-solicitacao",g.className="chamado-input",g.type="datetime-local",g.required=!0,v.appendChild(g),document.createElement("label")),E=(f.id="chamado-data-entrega-label",f.htmlFor="chamado-data-entrega",f.innerText="Data para a entrega",document.createElement("input")),C=(E.name="chamado-data-entrega",E.id="chamado-data-entrega",E.className="chamado-input",E.type="datetime-local",E.required=!0,f.appendChild(E),document.createElement("select")),_=(C.name="chamado-urgencia",C.id="chamado-urgencia",C.className="chamado-select",C.required=!0,document.createElement("option"));_.value="",_.textContent="Selecione o nível de urgência",C.appendChild(_);for(c of r){var L=document.createElement("option");L.value=c.term_id,L.textContent=c.name,C.appendChild(L)}var y,b=document.createElement("select"),_=(b.name="chamado-status",b.id="chamado-status",b.className="chamado-select",b.required=!0,document.createElement("option"));_.value="",_.textContent="Selecione o status",b.appendChild(_);for(y of i){var I=document.createElement("option");I.value=y.term_id,I.textContent=y.name,b.appendChild(I)}var S,x=document.createElement("select");for(S in x.id="chamado-profissional",x.name="chamado-profissional",x.className="chamado-select",x.required=!0,m){var w=document.createElement("option");w.value=0===parseInt(S)?"":parseInt(S),w.textContent=m[S],"Selecione o usuário"===w.textContent&&(w.textContent="Selecione o profissional"),x.appendChild(w)}var T,B=document.createElement("select"),r=(B.name="chamado-etapa",B.id="chamado-etapa",B.className="chamado-select",B.required=!0,document.createElement("option"));r.value="",r.textContent="Selecione a etapa",B.appendChild(r);for(T of s){var H=document.createElement("option");H.value=T.term_id,H.textContent=T.name,B.appendChild(H)}_=document.createElement("label"),_.id="chamado-detalhamento-resolucao-label",_.htmlFor="chamado-detalhamento-resolucao",_.innerText="Detalhamento da Resolução",i=document.createElement("textarea"),i.name="chamado-detalhamento-resolucao",i.id="chamado-detalhamento-resolucao",i.className="chamado-textarea",i.placeholder="Detalhamento da Resolução",i.rows="5",_.appendChild(i),r=document.createElement("label"),r.id="chamado-notificacao-label",r.htmlFor="chamado-notificacao",r.innerText="Notificação",s=document.createElement("input"),s.type="checkbox",s.id="chamado-notificacao",s.name="chamado-notificacao",s.className="chamado-checkbox",s.checked=!1,r.appendChild(s),s=document.createElement("button");s.type="submit",s.className="chamado-button",s.id="chamado-button",s.textContent="Salvar",s.addEventListener("click",()=>{tinyMCE.triggerSave()}),l&&e.chamado?(p.value=e.chamado.assunto,h.value=e.chamado.detalhamento_solicitacao,g.value=e.chamado.data_solicitacao,E.value=e.chamado.data_entrega,C.value=e.chamado.urgencia,b.value=e.chamado.status,x.value=e.chamado.profissional.id,B.value=e.chamado.etapa,i.value=e.chamado.detalhamento_resolucao):(p.value=completed_fields.assunto||"",h.value=completed_fields.detalhamento_solicitacao||"",g.value=completed_fields.data_solicitacao||"",E.value=completed_fields.data_entrega||"",C.value=completed_fields.urgencia||"",b.value=completed_fields.status||"",x.value=completed_fields.profissional||"",B.value=completed_fields.etapa||"",i.value=completed_fields.detalhamento_resolucao||""),d.appendChild(s),d.appendChild(r),d.appendChild(p),d.appendChild(u),d.appendChild(v),d.appendChild(f),d.appendChild(C),d.appendChild(b),d.appendChild(x),d.appendChild(B),d.appendChild(_)},removeChamadoInputs=()=>{tinyMCE.triggerSave();var e,a={cliente:"partner-chamado-cliente",marca:"partner-chamado-marca",assunto:"chamado-assunto",detalhamento_solicitacao:"chamado-detalhamento-solicitacao",data_solicitacao:"chamado-data-solicitacao",data_entrega:"chamado-data-entrega",urgencia:"chamado-urgencia",status:"chamado-status",profissional:"chamado-profissional",etapa:"chamado-etapa",detalhamento_resolucao:"chamado-detalhamento-resolucao"};for(e in a)void 0!==document.getElementById(a[e])&&null!==document.getElementById(a[e])&&(completed_fields[e]=document.getElementById(a[e]).value);var t=document.getElementById("chamado-assunto"),t=(null!=t&&t.remove(),document.getElementById("chamado-detalhamento-solicitacao-label")),t=(null!=t&&t.remove(),document.getElementById("chamado-data-solicitacao-label")),t=(null!=t&&t.remove(),document.getElementById("chamado-data-entrega-label")),t=(null!=t&&t.remove(),document.getElementById("chamado-urgencia")),t=(null!=t&&t.remove(),document.getElementById("chamado-ponto-focal")),t=(null!=t&&t.remove(),document.getElementById("chamado-status")),t=(null!=t&&t.remove(),document.getElementById("chamado-profissional")),t=(null!=t&&t.remove(),document.getElementById("chamado-etapa")),t=(null!=t&&t.remove(),document.getElementById("chamado-detalhamento-resolucao-label")),t=(null!=t&&t.remove(),document.getElementById("chamado-button")),t=(null!=t&&t.remove(),document.getElementById("chamado-notificacao-label"));null!=t&&t.remove(),wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")},partner_save_chamado=(e,a,t)=>{var o=new FormData(a),n=ajax_object.ajax_url,e=(o.append("action","partner_save_chamado"),o.append("post_id",e),o.append("partner_nonce",ajax_object.partner_nonce),{method:"POST",body:o});fetch(n,e).then(e=>e.json()).then(e=>{e.success?(a.remove(),closePopup(),changeSortSelect()):null!=(e=document.getElementById("loading"))&&(e.remove(),(e=document.createElement("div")).id="error",e.classList.add("error"),e.textContent="Ocorreu um erro ao tentar salvar o chamado.",t.insertBefore(e,t.firstChild))}).catch(function(e){console.error(e)})};function partner_ocultar_entregues(e){if(null!=e){var a,t=document.getElementById("filtro-status");if(null!=t)for(a of t.querySelectorAll('input[type="checkbox"]'))parseInt(a.value)!==parseInt(e)&&a.parentNode.click()}}function togglePontoFocalDescription(){var e;for(e of document.querySelectorAll(".partner-ponto-focal-atendimento_description")){let t=e.nextElementSibling;if(void 0===t&&null===t)return;if(!t.classList.contains("toggle-descricao"))return;t.getAttribute("data-toggle-status");let o=e;t.addEventListener("click",(e,a)=>{e.preventDefault(),a=t.getAttribute("data-toggle-status");e=o.scrollHeight;"collapsed"===a?(t.setAttribute("data-toggle-status","expanded"),o.setAttribute("data-toggle-status","expanded"),o.style.maxHeight=e+"px"):(t.setAttribute("data-toggle-status","collapsed"),o.setAttribute("data-toggle-status","collapsed"),o.style.maxHeight=0)})}}function setAHrefToOpenInNewTab(){var e,a=document.querySelector(".chamado-detalhamento-solicitacao-text");if(null!=a)for(e of a.querySelectorAll("a"))e.setAttribute("target","_blank");var t,a=document.querySelector(".chamado-detalhamento-resolucao-text");if(null!=a)for(t of a.querySelectorAll("a"))t.setAttribute("target","_blank")}let partner_dowload_csv=()=>{var e=document.getElementById("partner-download-csv");null!=e&&e.addEventListener("click",e=>{e.preventDefault();var e=new FormData,a=(e.append("action","partner_download_csv"),ajax_object.ajax_url);fetch(a,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success?(e=e.file_url,window.open(e)):console.log("Erro")}).catch(function(e){console.log(e)})})};function partner_aprovacao_notification(){var e,a,t=ajax_object.aprovacao_notificacao;t<=0||(e=document.querySelector(".item-aprovacao"))&&(e=e.querySelector(".jet-nav-link-text"))&&((a=document.createElement("span")).classList.add("aprovacao-notificao"),a.innerHTML=t,e.appendChild(a))}document.addEventListener("DOMContentLoaded",function(){popupCronogramaInit(),popupChamadosInit(),togglePontoFocalDescription(),partner_dowload_csv(),partner_aprovacao_notification()}),window.addEventListener("load",e=>{});