document.addEventListener("DOMContentLoaded",function(){const p=()=>{const e=document.querySelector(".partner-popup-wrapper");if(e){e.remove();const t=document.documentElement,a=document.body;t.style.overflow="",a.style.overflow=""}};const u=(v,f,E)=>{const C=new XMLHttpRequest;var e=v?"post_id="+v:"";C.responseType="json",C.open("POST",ajax_object.ajax_url+"?action=partner_get_chamado&"+e),C.onload=function(){var t=C.response;if(200===C.status)if(t.success){const e=document.getElementById("loading");void 0!==e&&null!==e&&e.remove();{var a=t;var r=v;var s=f;var m=E;const n=parseInt(a.cliente),o=a.marca,i=document.createElement("form");i.id="partner-chamado-form",i.classList.add("partner-chamado-form");let e;const d=a.clientes;if(r===null){e=document.createElement("select");const c=document.createElement("option");c.value="";c.innerHTML="Selecione um cliente";e.appendChild(c);for(const l of d){const p=document.createElement("option");p.value=l.ID;p.innerHTML=l.post_title;if(n===l.ID)p.selected=true;e.appendChild(p)}}else{e=document.createElement("input");e.type="hidden";e.value=n;const u=document.createElement("h4");for(const h of d)if(n===h.ID)u.textContent=`${h.post_title}`;i.appendChild(u)}if(e.id="partner-chamado-cliente",e.name="partner-chamado-cliente",i.appendChild(e),n)g(a,n,n,o,i);if(e.tagName==="SELECT")e.addEventListener("change",function(){const e=document.getElementById("partner-chamado-marca");if(typeof(e!=="undefined")&&e!==null)e.remove();y();const t=this.value;g(a,n,t,o,i)});i.addEventListener("submit",function(e){e.preventDefault();const t=new FormData(i);const a={};let n=null;for(const[d,c]of t.entries()){const l=document.getElementById(d);l.classList.remove("error");a[d]=c;if(!c){n=true;l.classList.add("error")}}if(n)return;const o=document.createElement("div");o.id="loading";o.classList.add("loading");o.textContent="Processando...";m.insertBefore(o,m.firstChild);L(a,r,i,s)}),m.appendChild(i),s.appendChild(m)}}else console.log(t)},C.send()},g=(e,t,a,n,o)=>{var d=e.marcas;const c=document.createElement("select");let l=null;if(c.id="partner-chamado-marca",c.name="partner-chamado-marca",a){d=d[a];const r=document.createElement("option");r.value="",r.textContent="Selecione uma marca",c.appendChild(r);for(const s of d){const m=document.createElement("option");m.textContent=s,m.value=s,n===s&&(m.selected=!0),c.appendChild(m)}c.addEventListener("change",()=>{y(),(l=c.value)&&i(e,t,a,n,l,o)}),o.appendChild(c),parseInt(t)===parseInt(a)&&(l=n,i(e,t,a,n,l,o))}},i=(e,t,a,n,o,d)=>{var c=e.urgencias,l=e.users,r=e.status;const s=document.createElement("input"),m=(s.type="text",s.name="chamado-assunto",s.id="chamado-assunto",s.className="chamado-input",s.placeholder="Assunto",s.required=!0,document.createElement("textarea")),i=(m.name="chamado-detalhamento-solicitacao",m.id="chamado-detalhamento-solicitacao",m.className="chamado-textarea",m.placeholder="Detalhamento da Solicitação",m.rows="5",m.required=!0,document.createElement("label")),p=(i.id="chamado-data-solicitacao-label",i.htmlFor="chamado-data-solicitacao",i.innerText="Data da solicitação",document.createElement("input")),u=(p.name="chamado-data-solicitacao",p.id="chamado-data-solicitacao",p.className="chamado-input",p.type="datetime-local",p.required=!0,i.appendChild(p),document.createElement("label")),h=(u.id="chamado-data-entrega-label",u.htmlFor="chamado-data-entrega",u.innerText="Data para a entrega",document.createElement("input")),v=(h.name="chamado-data-entrega",h.id="chamado-data-entrega",h.className="chamado-input",h.type="datetime-local",h.required=!0,u.appendChild(h),document.createElement("select")),f=(v.name="chamado-urgencia",v.id="chamado-urgencia",v.className="chamado-select",v.required=!0,document.createElement("option"));f.value="",f.textContent="Selecione o nível de urgência",v.appendChild(f);for(const x of c){const I=document.createElement("option");I.value=x.term_id,I.textContent=x.name,v.appendChild(I)}const E=document.createElement("select");E.id="chamado-ponto-focal",E.name="chamado-ponto-focal",E.className="chamado-select",E.required=!0;for(const _ in l){const b=document.createElement("option");b.value=0===parseInt(_)?"":parseInt(_),b.textContent=l[_],E.appendChild(b)}const C=document.createElement("select"),g=(C.name="chamado-status",C.id="chamado-status",C.className="chamado-select",C.required=!0,document.createElement("option"));g.value="",g.textContent="Selecione o status",C.appendChild(g);for(const w of r){const B=document.createElement("option");B.value=w.term_id,B.textContent=w.name,C.appendChild(B)}const y=document.createElement("textarea"),L=(y.name="chamado-detalhamento-resolucao",y.id="chamado-detalhamento-resolucao",y.className="chamado-textarea",y.placeholder="Detalhamento da Resolução",y.rows="5",y.required=!0,document.createElement("button"));L.type="submit",L.className="chamado-button",L.id="chamado-button",L.textContent="Enviar",e.chamado&&parseInt(t)===parseInt(a)&&n===o&&(s.value=e.chamado.assunto,m.value=e.chamado.detalhamento_solicitacao,p.value=e.chamado.data_solicitacao,h.value=e.chamado.data_entrega,v.value=e.chamado.urgencia,E.value=e.chamado.ponto_focal,C.value=e.chamado.status,y.value=e.chamado.detalhamento_resolucao),d.appendChild(s),d.appendChild(m),d.appendChild(i),d.appendChild(u),d.appendChild(v),d.appendChild(E),d.appendChild(C),d.appendChild(y),d.appendChild(L)},y=()=>{const e=document.getElementById("chamado-assunto"),t=(void 0!==e&&null!==e&&e.remove(),document.getElementById("chamado-detalhamento-solicitacao")),a=(void 0!==t&&null!==t&&t.remove(),document.getElementById("chamado-data-solicitacao-label")),n=(void 0!==a&&null!==a&&a.remove(),document.getElementById("chamado-data-entrega-label")),o=(void 0!==n&&null!==n&&n.remove(),document.getElementById("chamado-urgencia")),d=(void 0!==o&&null!==o&&o.remove(),document.getElementById("chamado-ponto-focal")),c=(void 0!==d&&null!==d&&d.remove(),document.getElementById("chamado-status")),l=(void 0!==c&&null!==c&&c.remove(),document.getElementById("chamado-detalhamento-resolucao")),r=(void 0!==l&&null!==l&&l.remove(),document.getElementById("chamado-button"));void 0!==r&&null!==r&&r.remove()},L=(e,t,n,o)=>{const d=new XMLHttpRequest;e=new URLSearchParams(e).toString();let a=ajax_object.ajax_url+"?action=partner_save_chamado&"+e;a+="&partner_nonce="+ajax_object.partner_nonce,null!=t&&(a+="&post_id="+t),d.responseType="json",d.open("POST",a),d.onload=function(){var e=d.response;if(200===d.status)if(e.success)n.remove(),location.reload();else{const t=document.getElementById("loading");if(void 0!==t&&null!==t){t.remove();const a=document.createElement("div");a.id="error",a.classList.add("error"),a.textContent="Ocorreu um erro ao tentar salvar o chamado.",o.insertBefore(a,o.firstChild),console.log(e)}}},d.send()};{var e=document.querySelectorAll(".partner-trigger-popup");const d=document.documentElement,c=document.body;for(const l of e)l.addEventListener("click",e=>{e.preventDefault(),d.style.overflow="hidden",c.style.overflow="hidden",p();e=l.dataset.partnerPopupId,e=document.querySelector("#"+e).innerHTML;const t=document.createElement("div"),a=(t.classList.add("popup-content"),t.id="popup-content",t.innerHTML=e,document.createElement("div")),n=(a.classList.add("partner-popup"),a.appendChild(t),document.createElement("a")),o=(n.classList.add("partner-popup-close"),n.innerHTML="&times;",a.appendChild(n),document.createElement("div"));o.classList.add("partner-popup-wrapper"),o.appendChild(a),document.body.insertBefore(o,document.body.firstChild),n.addEventListener("click",()=>{p()}),o.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&p()})})}for(const t of document.querySelectorAll(".partner-trigger-popup-chamados")){let e="";!function(i){i.addEventListener("click",e=>{e.preventDefault();p();const t=i.href.match(/post_id=(\d+)/);const a=typeof t!==undefined&&t!==null?i.href.split("?")[1].split("=")[1]:null;const n=document.createElement("div");n.classList.add("partner-popup");const o=document.createElement("a");o.classList.add("partner-popup-close");o.innerHTML="&times;";n.appendChild(o);const d=document.createElement("div");d.classList.add("popup-content");d.id="popup-content";const c=document.createElement("div");c.id="loading";c.classList.add("loading");c.textContent="Carregando...";d.appendChild(c);n.appendChild(d);const l=document.createElement("div");l.classList.add("partner-popup-wrapper");l.appendChild(n);document.body.insertBefore(l,document.body.firstChild);const r=document.documentElement;const s=document.body;r.style.overflow="hidden";s.style.overflow="hidden";o.addEventListener("click",()=>{p()});l.addEventListener("click",e=>{if(e.target.classList.contains("partner-popup-wrapper"))p()});const m=u(a,n,d)})}(e="A"===t.tagName?t:t.querySelector("a"))}});