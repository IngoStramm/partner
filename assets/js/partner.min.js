const closePopup=()=>{const e=document.querySelector(".partner-popup-wrapper");if(e){e.remove();const t=document.documentElement,a=document.body;t.style.overflow="",a.style.overflow="",wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")}},popupCronogramaInit=()=>{var e=document.querySelectorAll(".partner-trigger-popup");const d=document.documentElement,c=document.body;for(const r of e)r.addEventListener("click",e=>{e.preventDefault(),d.style.overflow="hidden",c.style.overflow="hidden",closePopup();e=r.dataset.partnerPopupId,e=document.querySelector("#"+e).innerHTML;const t=document.createElement("div"),a=(t.classList.add("popup-content"),t.id="popup-content",t.innerHTML=e,document.createElement("div")),o=(a.classList.add("partner-popup"),a.appendChild(t),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",a.appendChild(o),document.createElement("div"));n.classList.add("partner-popup-wrapper"),n.appendChild(a),document.body.insertBefore(n,document.body.firstChild),o.addEventListener("click",()=>{closePopup()}),n.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&closePopup()})})},popupChamadosInit=()=>{for(const t of document.querySelectorAll(".partner-trigger-popup-chamados")){let e="";e="A"===t.tagName?t:t.querySelector("a"),clickEventChamado(e)}},clickEventChamado=t=>{t.addEventListener("click",e=>{e.preventDefault(),triggerPopupChamados(t)})},triggerPopupChamados=function(e){closePopup();var t=e.href.match(/post_id=(\d+)/),t=null!==t?e.href.split("?")[1].split("=")[1]:null;const a=document.createElement("div"),o=(a.classList.add("partner-popup"),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",a.appendChild(o),document.createElement("div")),d=(n.classList.add("popup-content"),n.id="popup-content",document.createElement("div")),c=(d.id="loading",d.classList.add("loading"),d.textContent="Carregando...",n.appendChild(d),a.appendChild(n),document.createElement("div")),r=(c.classList.add("partner-popup-wrapper"),c.appendChild(a),document.body.insertBefore(c,document.body.firstChild),document.documentElement),l=document.body;r.style.overflow="hidden",l.style.overflow="hidden",o.addEventListener("click",()=>{closePopup()}),c.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&closePopup()});partner_get_chamado(t,a,n)},partner_get_chamado=(a,o,n)=>{const d=new XMLHttpRequest;var e=a?"post_id="+a:"";d.responseType="json",d.open("POST",ajax_object.ajax_url+"?action=partner_get_chamado&"+e),d.onload=function(){var e=d.response;if(200===d.status)if(e.success){const t=document.getElementById("loading");void 0!==t&&null!==t&&t.remove(),partner_set_chamado_form(e,a,o,n),wp.editor.initialize("chamado-detalhamento-solicitacao",{tinymce:!0}),wp.editor.initialize("chamado-detalhamento-resolucao",{tinymce:!0})}else console.log(e)},d.send()},partner_set_chamado_form=(a,l,i,m)=>{const o=parseInt(a.cliente),n=a.marca,s=document.createElement("form");s.id="partner-chamado-form",s.classList.add("partner-chamado-form");let e;var t=a.clientes;if(null===l){e=document.createElement("select");const d=document.createElement("option");d.value="",d.innerHTML="Selecione um cliente",e.appendChild(d);for(const c of t){const r=document.createElement("option");r.value=c.ID,r.innerHTML=c.post_title,o===c.ID&&(r.selected=!0),e.appendChild(r)}}else{(e=document.createElement("input")).type="hidden",e.value=o;const p=document.createElement("h4");for(const u of t)o===u.ID&&(p.textContent=""+u.post_title);s.appendChild(p)}e.id="partner-chamado-cliente",e.name="partner-chamado-cliente",s.appendChild(e),o&&partner_set_marcas_options(a,o,o,n,s),"SELECT"===e.tagName&&e.addEventListener("change",function(){const e=document.getElementById("partner-chamado-marca");e,null!==e&&e.remove(),removeChamadoInputs();var t=this.value;partner_set_marcas_options(a,o,t,n,s)}),s.addEventListener("submit",function(e){e.preventDefault(),tinyMCE.triggerSave();const t=new FormData(s),a={};let o=null;for(var[n,d]of t.entries()){const c=document.getElementById(n);c.classList.remove("error"),(a[n]=d)||(o=!0,c.classList.add("error"))}if(!o){const r=document.createElement("div");r.id="loading",r.classList.add("loading"),r.textContent="Processando...",m.insertBefore(r,m.firstChild),partner_save_chamado(a,l,s,i)}}),m.appendChild(s),i.appendChild(m)},partner_set_marcas_options=(e,t,a,o,n)=>{var d=e.marcas;const c=document.createElement("select");let r=null;if(c.id="partner-chamado-marca",c.name="partner-chamado-marca",a){d=d[a];const l=document.createElement("option");l.value="",l.textContent="Selecione uma marca",c.appendChild(l);for(const i of d){const m=document.createElement("option");m.textContent=i,m.value=i,o===i&&(m.selected=!0),c.appendChild(m)}c.addEventListener("change",()=>{removeChamadoInputs(),(r=c.value)&&(addChamadoInputs(e,t,a,o,r,n),wp.editor.initialize("chamado-detalhamento-solicitacao",{tinymce:!0}),wp.editor.initialize("chamado-detalhamento-resolucao",{tinymce:!0}))}),n.appendChild(c),parseInt(t)===parseInt(a)&&(r=o,addChamadoInputs(e,t,a,o,r,n))}},addChamadoInputs=(e,t,a,o,n,d)=>{var c=e.urgencias,r=e.users,l=e.status;const i=document.createElement("input"),m=(i.type="text",i.name="chamado-assunto",i.id="chamado-assunto",i.className="chamado-input",i.placeholder="Assunto",i.required=!0,document.createElement("textarea")),s=(m.name="chamado-detalhamento-solicitacao",m.id="chamado-detalhamento-solicitacao",m.className="chamado-textarea",m.placeholder="Detalhamento da Solicitação",m.rows="5",m.required=!0,document.createElement("label")),p=(s.id="chamado-data-solicitacao-label",s.htmlFor="chamado-data-solicitacao",s.innerText="Data da solicitação",document.createElement("input")),u=(p.name="chamado-data-solicitacao",p.id="chamado-data-solicitacao",p.className="chamado-input",p.type="datetime-local",p.required=!0,s.appendChild(p),document.createElement("label")),h=(u.id="chamado-data-entrega-label",u.htmlFor="chamado-data-entrega",u.innerText="Data para a entrega",document.createElement("input")),v=(h.name="chamado-data-entrega",h.id="chamado-data-entrega",h.className="chamado-input",h.type="datetime-local",h.required=!0,u.appendChild(h),document.createElement("select")),E=(v.name="chamado-urgencia",v.id="chamado-urgencia",v.className="chamado-select",v.required=!0,document.createElement("option"));E.value="",E.textContent="Selecione o nível de urgência",v.appendChild(E);for(const L of c){const I=document.createElement("option");I.value=L.term_id,I.textContent=L.name,v.appendChild(I)}const f=document.createElement("select");f.id="chamado-ponto-focal",f.name="chamado-ponto-focal",f.className="chamado-select",f.required=!0;for(const b in r){const w=document.createElement("option");w.value=0===parseInt(b)?"":parseInt(b),w.textContent=r[b],f.appendChild(w)}const C=document.createElement("select"),g=(C.name="chamado-status",C.id="chamado-status",C.className="chamado-select",C.required=!0,document.createElement("option"));g.value="",g.textContent="Selecione o status",C.appendChild(g);for(const x of l){const q=document.createElement("option");q.value=x.term_id,q.textContent=x.name,C.appendChild(q)}const y=document.createElement("textarea"),_=(y.name="chamado-detalhamento-resolucao",y.id="chamado-detalhamento-resolucao",y.className="chamado-textarea",y.placeholder="Detalhamento da Resolução",y.rows="5",y.required=!0,document.createElement("button"));_.type="submit",_.className="chamado-button",_.id="chamado-button",_.textContent="Enviar",e.chamado&&parseInt(t)===parseInt(a)&&o===n&&(i.value=e.chamado.assunto,m.value=e.chamado.detalhamento_solicitacao,p.value=e.chamado.data_solicitacao,h.value=e.chamado.data_entrega,v.value=e.chamado.urgencia,f.value=e.chamado.ponto_focal,C.value=e.chamado.status,y.value=e.chamado.detalhamento_resolucao),d.appendChild(i),d.appendChild(m),d.appendChild(s),d.appendChild(u),d.appendChild(v),d.appendChild(f),d.appendChild(C),d.appendChild(y),d.appendChild(_)},removeChamadoInputs=()=>{const e=document.getElementById("chamado-assunto"),t=(void 0!==e&&null!==e&&e.remove(),document.getElementById("chamado-detalhamento-solicitacao")),a=(void 0!==t&&null!==t&&t.remove(),document.getElementById("chamado-data-solicitacao-label")),o=(void 0!==a&&null!==a&&a.remove(),document.getElementById("chamado-data-entrega-label")),n=(void 0!==o&&null!==o&&o.remove(),document.getElementById("chamado-urgencia")),d=(void 0!==n&&null!==n&&n.remove(),document.getElementById("chamado-ponto-focal")),c=(void 0!==d&&null!==d&&d.remove(),document.getElementById("chamado-status")),r=(void 0!==c&&null!==c&&c.remove(),document.getElementById("chamado-detalhamento-resolucao")),l=(void 0!==r&&null!==r&&r.remove(),document.getElementById("chamado-button"));void 0!==l&&null!==l&&l.remove(),wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")},partner_save_chamado=(e,t,o,n)=>{const d=new XMLHttpRequest;e=new URLSearchParams(e).toString();let a=ajax_object.ajax_url+"?action=partner_save_chamado&"+e;a+="&partner_nonce="+ajax_object.partner_nonce,null!=t&&(a+="&post_id="+t),d.responseType="json",d.open("POST",a),d.onload=function(){var e=d.response;if(200===d.status)if(e.success)o.remove(),location.reload();else{const t=document.getElementById("loading");if(void 0!==t&&null!==t){t.remove();const a=document.createElement("div");a.id="error",a.classList.add("error"),a.textContent="Ocorreu um erro ao tentar salvar o chamado.",n.insertBefore(a,n.firstChild),console.log(e)}}},d.send()};function chamadoWrapper(){for(const e of document.querySelectorAll(".chamado-wrapper")){const t=e.querySelector(".btn-edit-chamado");if(void 0===t||null===t)return;e.addEventListener("click",function(e){t.click()})}}document.addEventListener("DOMContentLoaded",function(){popupCronogramaInit(),popupChamadosInit(),chamadoWrapper()}),jQuery(document).on("tinymce-editor-setup",function(e,t){t.settings.toolbar1="bold,italic,underline,blockquote,strikethrough,bullist,numlist,alignleft,aligncenter,alignright,undo,redo,link"});