const closePopup=()=>{const e=document.querySelector(".partner-popup-wrapper");if(e){e.remove();const a=document.documentElement,t=document.body;a.style.overflow="",t.style.overflow="",wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")}},wpEditorSettings=()=>({tinymce:!0,quicktags:!1,mediaButtons:!1}),popupCronogramaInit=()=>{var e=document.querySelectorAll(".partner-trigger-popup");const d=document.documentElement,c=document.body;for(const r of e)r.addEventListener("click",e=>{e.preventDefault(),d.style.overflow="hidden",c.style.overflow="hidden",closePopup();e=r.dataset.partnerPopupId,e=document.querySelector("#"+e).innerHTML;const a=document.createElement("div"),t=(a.classList.add("popup-content"),a.id="popup-content",a.innerHTML=e,document.createElement("div")),o=(t.classList.add("partner-popup"),t.appendChild(a),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",t.appendChild(o),document.createElement("div"));n.classList.add("partner-popup-wrapper"),n.appendChild(t),document.body.insertBefore(n,document.body.firstChild),o.addEventListener("click",()=>{closePopup()}),n.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&closePopup()})})},popupChamadosInit=()=>{for(const a of document.querySelectorAll(".partner-trigger-popup-chamados")){let e="";e="A"===a.tagName?a:a.querySelector("a"),clickEventChamado(e)}},clickEventChamado=a=>{a.addEventListener("click",e=>{e.preventDefault(),triggerPopupChamados(a)})},triggerPopupChamados=function(e,a=null){closePopup();const t=document.createElement("div"),o=(t.classList.add("partner-popup"),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",t.appendChild(o),document.createElement("div")),d=(n.classList.add("popup-content"),n.id="popup-content",document.createElement("div")),c=(d.id="loading",d.classList.add("loading"),d.textContent="Carregando...",n.appendChild(d),t.appendChild(n),document.createElement("div")),r=(c.classList.add("partner-popup-wrapper"),c.appendChild(t),document.body.insertBefore(c,document.body.firstChild),document.documentElement),l=document.body;r.style.overflow="hidden",l.style.overflow="hidden",o.addEventListener("click",()=>{closePopup()}),c.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&closePopup()});partner_get_chamado(e,a,t,n)},partner_get_chamado=(o,n,d,c)=>{const r=new XMLHttpRequest;var e=n?"post_id="+n:"";r.responseType="json",r.open("POST",ajax_object.ajax_url+"?action=partner_get_chamado&"+e),r.onload=function(){var e=r.response;if(200===r.status)if(e.success){const t=document.getElementById("loading");void 0!==t&&null!==t&&t.remove(),("view"===o?partner_view_chamado:partner_set_chamado_form)(e,n,d,c);var a=wpEditorSettings();wp.editor.initialize("chamado-detalhamento-solicitacao",a),wp.editor.initialize("chamado-detalhamento-resolucao",a)}else console.log(e)},r.send()},partner_view_chamado=(o,e,n,d)=>{if(void 0===o.chamado||null===o.chamado)console.log(o);else{var c=o.chamado,r=parseInt(c.cliente);let e=null;for(const b of o.clientes)b.ID===r&&(e=b);var l=parseInt(c.urgencia);let a=null;for(const T of o.urgencias)T.term_id===l&&(a=T);var s=parseInt(c.status);let t=null;for(const M of o.status)M.term_id===s&&(t=M);var i=c.ponto_focal,o=o.users[i];const m=document.createElement("h4"),p=(m.classList.add("cliente-title"),m.textContent=e.post_title,d.appendChild(m),document.createElement("p")),u=(p.classList.add("chamado-marca"),p.innerHTML="<strong>Marca:</strong> "+c.marca,d.appendChild(p),document.createElement("p")),h=(u.classList.add("chamado-assunto"),u.innerHTML="<strong>Assunto:</strong> "+c.assunto,d.appendChild(u),document.createElement("p")),v=(h.classList.add("chamado-detalhamento-solicitacao-title"),h.innerHTML="<strong>Detalhes da Solicitação:</strong>",d.appendChild(h),document.createElement("div")),g=(v.classList.add("chamado-detalhamento-solicitacao-text"),v.innerHTML=c.detalhamento_solicitacao,d.appendChild(v),document.createElement("p")),E=(g.classList.add("chamado-data-solicitacao"),new Date(c.data_solicitacao)),C=(g.innerHTML="<strong>Data da Solicitação:</strong> "+E.toLocaleDateString("pt-BR",{hour:"numeric",minute:"numeric",hour12:!1}),d.appendChild(g),document.createElement("p")),f=(C.classList.add("chamado-data-ultima-modificacao"),new Date(c.post_modified)),L=(C.innerHTML="<strong>Última atualização:</strong> "+f.toLocaleDateString("pt-BR",{hour:"numeric",minute:"numeric",hour12:!1}),d.appendChild(C),document.createElement("p")),_=(L.classList.add("chamado-previsao-entrega"),new Date(c.data_entrega)),y=(L.innerHTML="<strong>Previsão de entrega:</strong> "+_.toLocaleDateString("pt-BR",{hour:"numeric",minute:"numeric",hour12:!1}),d.appendChild(L),document.createElement("p")),I=(y.classList.add("chamado-urgencia"),y.innerHTML=`<strong>Urgência:</strong> <span class="urgencia-label" style="background-color: ${a.cor}">${a.name}</span>`,d.appendChild(y),document.createElement("p")),w=(I.classList.add("chamado-ponto-focal"),I.innerHTML="<strong>Ponto focal:</strong> "+o,d.appendChild(I),document.createElement("p")),x=(w.classList.add("chamado-status"),w.innerHTML=`<strong>Status:</strong> <span style="color: ${t.cor}">${t.name}</span>`,d.appendChild(w),document.createElement("p")),S=(x.classList.add("chamado-detalhamento-resolucao-title"),x.innerHTML="<strong>Detalhes da Resolução:</strong>",d.appendChild(x),document.createElement("div"));S.classList.add("chamado-detalhamento-resolucao-text"),S.innerHTML=c.detalhamento_resolucao,d.appendChild(S),n.appendChild(d)}},partner_set_chamado_form=(t,l,s,i)=>{const o=parseInt(t.cliente),n=t.marca,m=document.createElement("form");m.id="partner-chamado-form",m.classList.add("partner-chamado-form");let e;var a=t.clientes;if(null===l){e=document.createElement("select");const d=document.createElement("option");d.value="",d.innerHTML="Selecione um cliente",e.appendChild(d);for(const c of a){const r=document.createElement("option");r.value=c.ID,r.innerHTML=c.post_title,o===c.ID&&(r.selected=!0),e.appendChild(r)}}else{(e=document.createElement("input")).type="hidden",e.value=o;const p=document.createElement("h4");for(const u of a)o===u.ID&&(p.textContent=""+u.post_title);m.appendChild(p)}e.id="partner-chamado-cliente",e.name="partner-chamado-cliente",m.appendChild(e),o&&partner_set_marcas_options(t,o,o,n,m),"SELECT"===e.tagName&&e.addEventListener("change",function(){const e=document.getElementById("partner-chamado-marca");e,null!==e&&e.remove(),removeChamadoInputs();var a=this.value;partner_set_marcas_options(t,o,a,n,m)}),m.addEventListener("submit",function(e){e.preventDefault(),tinyMCE.triggerSave();const a=new FormData(m),t={};let o=null;for(var[n,d]of a.entries()){const c=document.getElementById(n);c.classList.remove("error"),t[n]=d,"chamado-detalhamento-solicitacao"===n||"chamado-detalhamento-resolucao"===n||d||(o=!0,c.classList.add("error"))}if(!o){const r=document.createElement("div");r.id="loading",r.classList.add("loading"),r.textContent="Processando...",i.insertBefore(r,i.firstChild),partner_save_chamado(t,l,m,s)}}),i.appendChild(m),s.appendChild(i)},partner_set_marcas_options=(a,t,o,n,d)=>{var e=a.marcas;const c=document.createElement("select");let r=null;if(c.id="partner-chamado-marca",c.name="partner-chamado-marca",o){e=e[o];const l=document.createElement("option");l.value="",l.textContent="Selecione uma marca",c.appendChild(l);for(const s of e){const i=document.createElement("option");i.textContent=s,i.value=s,n===s&&(i.selected=!0),c.appendChild(i)}c.addEventListener("change",()=>{var e;removeChamadoInputs(),(r=c.value)&&(addChamadoInputs(a,t,o,n,r,d),e=wpEditorSettings(),wp.editor.initialize("chamado-detalhamento-solicitacao",e),wp.editor.initialize("chamado-detalhamento-resolucao",e))}),d.appendChild(c),parseInt(t)===parseInt(o)&&(r=n,addChamadoInputs(a,t,o,n,r,d))}},addChamadoInputs=(e,a,t,o,n,d)=>{var c=e.urgencias,r=e.users,l=e.status;const s=document.createElement("input"),i=(s.type="text",s.name="chamado-assunto",s.id="chamado-assunto",s.className="chamado-input",s.placeholder="Assunto",s.required=!0,document.createElement("textarea")),m=(i.name="chamado-detalhamento-solicitacao",i.id="chamado-detalhamento-solicitacao",i.className="chamado-textarea",i.placeholder="Detalhamento da Solicitação",i.rows="5",document.createElement("label")),p=(m.id="chamado-data-solicitacao-label",m.htmlFor="chamado-data-solicitacao",m.innerText="Data da solicitação",document.createElement("input")),u=(p.name="chamado-data-solicitacao",p.id="chamado-data-solicitacao",p.className="chamado-input",p.type="datetime-local",p.required=!0,m.appendChild(p),document.createElement("label")),h=(u.id="chamado-data-entrega-label",u.htmlFor="chamado-data-entrega",u.innerText="Data para a entrega",document.createElement("input")),v=(h.name="chamado-data-entrega",h.id="chamado-data-entrega",h.className="chamado-input",h.type="datetime-local",h.required=!0,u.appendChild(h),document.createElement("select")),g=(v.name="chamado-urgencia",v.id="chamado-urgencia",v.className="chamado-select",v.required=!0,document.createElement("option"));g.value="",g.textContent="Selecione o nível de urgência",v.appendChild(g);for(const y of c){const I=document.createElement("option");I.value=y.term_id,I.textContent=y.name,v.appendChild(I)}const E=document.createElement("select");E.id="chamado-ponto-focal",E.name="chamado-ponto-focal",E.className="chamado-select",E.required=!0;for(const w in r){const x=document.createElement("option");x.value=0===parseInt(w)?"":parseInt(w),x.textContent=r[w],E.appendChild(x)}const C=document.createElement("select"),f=(C.name="chamado-status",C.id="chamado-status",C.className="chamado-select",C.required=!0,document.createElement("option"));f.value="",f.textContent="Selecione o status",C.appendChild(f);for(const S of l){const b=document.createElement("option");b.value=S.term_id,b.textContent=S.name,C.appendChild(b)}const L=document.createElement("textarea"),_=(L.name="chamado-detalhamento-resolucao",L.id="chamado-detalhamento-resolucao",L.className="chamado-textarea",L.placeholder="Detalhamento da Resolução",L.rows="5",document.createElement("button"));_.type="submit",_.className="chamado-button",_.id="chamado-button",_.textContent="Enviar",_.addEventListener("click",()=>{tinyMCE.triggerSave()}),e.chamado&&parseInt(a)===parseInt(t)&&o===n&&(s.value=e.chamado.assunto,i.value=e.chamado.detalhamento_solicitacao,p.value=e.chamado.data_solicitacao,h.value=e.chamado.data_entrega,v.value=e.chamado.urgencia,E.value=e.chamado.ponto_focal,C.value=e.chamado.status,L.value=e.chamado.detalhamento_resolucao),d.appendChild(_),d.appendChild(s),d.appendChild(i),d.appendChild(m),d.appendChild(u),d.appendChild(v),d.appendChild(E),d.appendChild(C),d.appendChild(L)},removeChamadoInputs=()=>{const e=document.getElementById("chamado-assunto"),a=(void 0!==e&&null!==e&&e.remove(),document.getElementById("chamado-detalhamento-solicitacao")),t=(void 0!==a&&null!==a&&a.remove(),document.getElementById("chamado-data-solicitacao-label")),o=(void 0!==t&&null!==t&&t.remove(),document.getElementById("chamado-data-entrega-label")),n=(void 0!==o&&null!==o&&o.remove(),document.getElementById("chamado-urgencia")),d=(void 0!==n&&null!==n&&n.remove(),document.getElementById("chamado-ponto-focal")),c=(void 0!==d&&null!==d&&d.remove(),document.getElementById("chamado-status")),r=(void 0!==c&&null!==c&&c.remove(),document.getElementById("chamado-detalhamento-resolucao")),l=(void 0!==r&&null!==r&&r.remove(),document.getElementById("chamado-button"));void 0!==l&&null!==l&&l.remove(),wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")},partner_save_chamado=(e,a,o,n)=>{const d=new XMLHttpRequest;e=new URLSearchParams(e).toString();let t=ajax_object.ajax_url+"?action=partner_save_chamado&"+e;t+="&partner_nonce="+ajax_object.partner_nonce,null!=a&&(t+="&post_id="+a),d.responseType="json",d.open("POST",t),d.onload=function(){var e=d.response;if(200===d.status)if(e.success)o.remove(),location.reload();else{const a=document.getElementById("loading");if(void 0!==a&&null!==a){a.remove();const t=document.createElement("div");t.id="error",t.classList.add("error"),t.textContent="Ocorreu um erro ao tentar salvar o chamado.",n.insertBefore(t,n.firstChild),console.log(e)}}},d.send()};function partner_ocultar_entregues(e){if(null!=e){const a=document.getElementById("filtro-status");if(void 0!==a&&null!==a)for(const t of a.querySelectorAll('input[type="checkbox"]'))if(parseInt(t.value)!==parseInt(e)){const o=t.parentNode;o.click()}}}document.addEventListener("DOMContentLoaded",function(){popupCronogramaInit(),popupChamadosInit()});