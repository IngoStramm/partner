let completed_fields=[];const closePopup=()=>{const e=document.querySelector(".partner-popup-wrapper");if(e){e.remove();const a=document.documentElement,t=document.body;a.style.overflow="",t.style.overflow="",wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")}completed_fields=[]},wpEditorSettings=()=>({tinymce:!0,quicktags:!1,mediaButtons:!1}),popupCronogramaInit=()=>{var e=document.querySelectorAll(".partner-trigger-popup");const d=document.documentElement,c=document.body;for(const l of e)l.addEventListener("click",e=>{e.preventDefault(),d.style.overflow="hidden",c.style.overflow="hidden",closePopup();e=l.dataset.partnerPopupId,e=document.querySelector("#"+e).innerHTML;const a=document.createElement("div"),t=(a.classList.add("popup-content"),a.id="popup-content",a.innerHTML=e,document.createElement("div")),o=(t.classList.add("partner-popup"),t.appendChild(a),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",t.appendChild(o),document.createElement("div"));n.classList.add("partner-popup-wrapper"),n.appendChild(t),document.body.insertBefore(n,document.body.firstChild),o.addEventListener("click",()=>{closePopup()}),n.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&closePopup()})})},popupChamadosInit=()=>{for(const a of document.querySelectorAll(".partner-trigger-popup-chamados")){let e="";e="A"===a.tagName?a:a.querySelector("a"),clickEventChamado(e)}},clickEventChamado=a=>{a.addEventListener("click",e=>{e.preventDefault(),triggerPopupChamados(a)})},changeSortSelect=()=>{const a=document.querySelector(".jet-sorting-select");if(void 0!==a&&null!==a){var t=a.value,o=a.options;let e=null;var n=a.dataset.oldValue;if("opened"===a.dataset.popupStatus)a.setAttribute("data-popup-status","closed"),e=n;else{a.setAttribute("data-popup-status","opened"),a.setAttribute("data-old-value",t);for(const d of o)if(d.value!==t){e=d.value;break}}a.value=e,a.dispatchEvent(new Event("change"))}},triggerPopupChamados=function(e,a=null){closePopup(),changeSortSelect();const t=document.createElement("div"),o=(t.classList.add("partner-popup"),document.createElement("a")),n=(o.classList.add("partner-popup-close"),o.innerHTML="&times;",t.appendChild(o),document.createElement("div")),d=(n.classList.add("popup-content"),n.id="popup-content",document.createElement("div")),c=(d.id="loading",d.classList.add("loading"),d.textContent="Carregando...",n.appendChild(d),t.appendChild(n),document.createElement("div")),l=(c.classList.add("partner-popup-wrapper"),c.appendChild(t),document.body.insertBefore(c,document.body.firstChild),setAHrefToOpenInNewTab(),document.documentElement),i=document.body;l.style.overflow="hidden",i.style.overflow="hidden",o.addEventListener("click",()=>{closePopup(),changeSortSelect()}),c.addEventListener("click",e=>{e.target.classList.contains("partner-popup-wrapper")&&(closePopup(),changeSortSelect())});partner_get_chamado(e,a,t,n)},partner_get_chamado=(o,n,d,c)=>{const l=new XMLHttpRequest;var e=n?"post_id="+n:"";l.responseType="json",l.open("POST",ajax_object.ajax_url+"?action=partner_get_chamado&"+e),l.onload=function(){var e=l.response;if(200===l.status)if(e.success){const t=document.getElementById("loading");void 0!==t&&null!==t&&t.remove(),("view"===o?partner_view_chamado:partner_set_chamado_form)(e,n,d,c);var a=wpEditorSettings();wp.editor.initialize("chamado-detalhamento-solicitacao",a),wp.editor.initialize("chamado-detalhamento-resolucao",a),setAHrefToOpenInNewTab()}else console.log(e)},l.send()},partner_view_chamado=(d,e,c,l)=>{if(void 0===d.chamado||null===d.chamado)console.log(d);else{var i=d.chamado,s=parseInt(i.cliente);for(const q of d.clientes)q.ID===s&&q;var r=parseInt(i.urgencia);let e=null;for(const P of d.urgencias)P.term_id===r&&(e=P);var m=parseInt(i.status);let a=null;for(const N of d.status)N.term_id===m&&(a=N);var p=parseInt(i.etapa);let t=null;for(const $ of d.etapas)$.term_id===p&&(t=$);var d=i.profissional.name,O=i.sucesso_cliente.name,R=i.contato_emergencia.name;l.classList.add("chamado-view");const v=document.createElement("aside"),g=(v.id="chamado-aside",v.classList.add("chamado-aside"),document.createElement("div")),f=(g.id="chamado-aside-column-1",g.classList.add("chamado-aside-column"),document.createElement("div")),E=(f.classList.add("chamado-id"),f.innerHTML=`<h3>#${i.id}</h3>`,g.appendChild(f),document.createElement("div")),C=(E.classList.add("chamado-marca"),E.innerHTML=`<h5>Marca</h5><h3>${i.marca}</h3>`,g.appendChild(E),document.createElement("div")),_=(C.classList.add("chamado-assunto"),C.innerHTML=`<h5>Assunto</h5><h3>${i.assunto}</h3>`,g.appendChild(C),v.appendChild(g),document.createElement("div")),L=(_.id="chamado-aside-column-2",_.classList.add("chamado-aside-column"),document.createElement("div")),y=(L.classList.add("chamado-data-solicitacao"),new Date(i.data_solicitacao));let o=y.toLocaleString("pt-BR",{month:"short"});o=o.slice(0,-1);var u=y.getDate(),h=y.toLocaleString("pt-BR",{hour:"numeric",minute:"numeric"});L.innerHTML=`<h5>Data da Solicitação</h5><p><span class="dia">${u}</span><span class="mes">${o}</span><span class="hora">${h}</span></p>`,_.appendChild(L);const b=document.createElement("div"),I=(b.classList.add("chamado-previsao-entrega"),new Date(i.data_entrega));let n=I.toLocaleString("pt-BR",{month:"short"});n=n.slice(0,-1);u=I.getDate(),h=I.toLocaleString("pt-BR",{hour:"numeric",minute:"numeric"});b.innerHTML=`<h5>Previsão de entrega</h5><p><span class="dia">${u}</span><span class="mes">${n}</span><span class="hora">${h}</span></p>`,_.appendChild(b),v.appendChild(_);const S=document.createElement("div"),x=(S.id="chamado-aside-column-3",S.classList.add("chamado-aside-column"),document.createElement("div")),w=(x.classList.add("chamado-urgencia"),x.innerHTML=`
    <h5>Tags:</h5>
    <ul class="chamado-tags">
    <li><span class="chamado-label" style="background-color: ${e.cor}">${e.name}</span></li>
    <li><span class="chamado-label" style="background-color: ${a.cor}">${a.name}</span></li>
    </ul>`,S.appendChild(x),v.appendChild(S),l.appendChild(v),document.createElement("div")),T=(w.id="chamado-content",w.classList.add("chamado-content"),document.createElement("p")),B=(T.classList.add("chamado-detalhamento-solicitacao-title"),T.innerHTML="<h5>Solicitação</h5>",w.appendChild(T),document.createElement("div")),H=(B.classList.add("chamado-detalhamento-solicitacao-text"),B.innerHTML=i.detalhamento_solicitacao,w.appendChild(B),document.createElement("p")),D=(H.classList.add("chamado-detalhamento-resolucao-title"),H.innerHTML="<h5>Resolução</h5>",w.appendChild(H),document.createElement("div"));if(D.classList.add("chamado-detalhamento-resolucao-text"),D.innerHTML=i.detalhamento_resolucao,w.appendChild(D),d){const j=document.createElement("div");j.classList.add("chamado-profissional"),j.innerHTML=`<h5>Profissional</h5><p>${d}</p>`,w.appendChild(j)}if(t){const F=document.createElement("div");F.classList.add("chamado-etapa"),F.innerHTML=`<h5>Etapa</h5><p>${t.name}</p>`,w.appendChild(F)}const M=document.createElement("div"),k=(M.classList.add("chamado-ponto-focal"),document.createElement("h5")),A=(k.innerHTML="Ponto Focal",M.appendChild(k),document.createElement("p"));A.innerHTML=O+`, ${R}.`,M.appendChild(A),w.appendChild(M),l.appendChild(w),c.appendChild(l)}},partner_set_chamado_form=(t,i,s,r)=>{const o=parseInt(t.cliente),n=t.marca,m=document.createElement("form");m.id="partner-chamado-form",m.classList.add("partner-chamado-form");let e;var a=t.clientes;if(null===i){e=document.createElement("select");const d=document.createElement("option");d.value="",d.innerHTML="Selecione um cliente",e.appendChild(d);for(const c of a){const l=document.createElement("option");l.value=c.ID,l.innerHTML=c.post_title,o===c.ID&&(l.selected=!0),e.appendChild(l)}}else{(e=document.createElement("input")).type="hidden",e.value=o;const p=document.createElement("h4");for(const u of a)o===u.ID&&(p.textContent=u.post_title+" #"+t.chamado.id);m.appendChild(p)}e.id="partner-chamado-cliente",e.name="partner-chamado-cliente",m.appendChild(e),o&&partner_set_marcas_options(t,o,o,n,m),"SELECT"===e.tagName&&e.addEventListener("change",function(){const e=document.getElementById("partner-chamado-marca");e,null!==e&&e.remove(),removeChamadoInputs();var a=this.value;partner_set_marcas_options(t,o,a,n,m)}),m.addEventListener("submit",function(e){e.preventDefault(),tinyMCE.triggerSave();const a=new FormData(m),t={};let o=null;for(var[n,d]of a.entries()){const c=document.getElementById(n);c.classList.remove("error"),t[n]=d,"chamado-detalhamento-solicitacao"===n||"chamado-detalhamento-resolucao"===n||d||(o=!0,c.classList.add("error"))}if(!o){const l=document.createElement("div");l.id="loading",l.classList.add("loading"),l.textContent="Processando...",r.insertBefore(l,r.firstChild),partner_save_chamado(i,m,s)}}),r.appendChild(m),s.appendChild(r)},partner_set_marcas_options=(a,t,o,n,d)=>{var e=a.marcas;const c=document.createElement("select");let l=null;if(c.id="partner-chamado-marca",c.name="partner-chamado-marca",o){e=e[o];const i=document.createElement("option");i.value="",i.textContent="Selecione uma marca",c.appendChild(i);for(const s of e){const r=document.createElement("option");r.textContent=s,r.value=s,n===s&&(r.selected=!0),c.appendChild(r)}c.addEventListener("change",()=>{var e;removeChamadoInputs(),(l=c.value)&&(addChamadoInputs(a,t,o,n,l,d),e=wpEditorSettings(),wp.editor.initialize("chamado-detalhamento-solicitacao",e),wp.editor.initialize("chamado-detalhamento-resolucao",e))}),d.appendChild(c),parseInt(t)===parseInt(o)&&(l=n,addChamadoInputs(a,t,o,n,l,d,!0))}},addChamadoInputs=(e,a,t,P,N,o,n=!1)=>{var d=e.urgencias,c=e.status,l=e.users,i=e.etapas;const s=document.createElement("input"),r=(s.type="text",s.name="chamado-assunto",s.id="chamado-assunto",s.className="chamado-input",s.placeholder="Assunto",s.required=!0,document.createElement("label")),m=(r.id="chamado-detalhamento-solicitacao-label",r.htmlFor="chamado-detalhamento-solicitacao",r.innerText="Detalhamento da solicitação",document.createElement("textarea")),p=(m.name="chamado-detalhamento-solicitacao",m.id="chamado-detalhamento-solicitacao",m.className="chamado-textarea",m.placeholder="Detalhamento da Solicitação",m.rows="5",r.appendChild(m),document.createElement("label")),u=(p.id="chamado-data-solicitacao-label",p.htmlFor="chamado-data-solicitacao",p.innerText="Data da solicitação",document.createElement("input")),h=(u.name="chamado-data-solicitacao",u.id="chamado-data-solicitacao",u.className="chamado-input",u.type="datetime-local",u.required=!0,p.appendChild(u),document.createElement("label")),v=(h.id="chamado-data-entrega-label",h.htmlFor="chamado-data-entrega",h.innerText="Data para a entrega",document.createElement("input")),g=(v.name="chamado-data-entrega",v.id="chamado-data-entrega",v.className="chamado-input",v.type="datetime-local",v.required=!0,h.appendChild(v),document.createElement("select")),f=(g.name="chamado-urgencia",g.id="chamado-urgencia",g.className="chamado-select",g.required=!0,document.createElement("option"));f.value="",f.textContent="Selecione o nível de urgência",g.appendChild(f);for(const T of d){const B=document.createElement("option");B.value=T.term_id,B.textContent=T.name,g.appendChild(B)}const E=document.createElement("select"),C=(E.name="chamado-status",E.id="chamado-status",E.className="chamado-select",E.required=!0,document.createElement("option"));C.value="",C.textContent="Selecione o status",E.appendChild(C);for(const H of c){const D=document.createElement("option");D.value=H.term_id,D.textContent=H.name,E.appendChild(D)}const _=document.createElement("select");_.id="chamado-profissional",_.name="chamado-profissional",_.className="chamado-select",_.required=!0;for(const M in l){const k=document.createElement("option");k.value=0===parseInt(M)?"":parseInt(M),k.textContent=l[M],"Selecione o usuário"===k.textContent&&(k.textContent="Selecione o profissional"),_.appendChild(k)}const L=document.createElement("select"),y=(L.name="chamado-etapa",L.id="chamado-etapa",L.className="chamado-select",L.required=!0,document.createElement("option"));y.value="",y.textContent="Selecione a etapa",L.appendChild(y);for(const A of i){const q=document.createElement("option");q.value=A.term_id,q.textContent=A.name,L.appendChild(q)}const b=document.createElement("label"),I=(b.id="chamado-detalhamento-resolucao-label",b.htmlFor="chamado-detalhamento-resolucao",b.innerText="Detalhamento da Resolução",document.createElement("textarea")),S=(I.name="chamado-detalhamento-resolucao",I.id="chamado-detalhamento-resolucao",I.className="chamado-textarea",I.placeholder="Detalhamento da Resolução",I.rows="5",b.appendChild(I),document.createElement("label")),x=(S.id="chamado-notificacao-label",S.htmlFor="chamado-notificacao",S.innerText="Notificação",document.createElement("input")),w=(x.type="checkbox",x.id="chamado-notificacao",x.name="chamado-notificacao",x.className="chamado-checkbox",x.checked=!1,S.appendChild(x),document.createElement("button"));w.type="submit",w.className="chamado-button",w.id="chamado-button",w.textContent="Salvar",w.addEventListener("click",()=>{tinyMCE.triggerSave()}),n&&e.chamado?(s.value=e.chamado.assunto,m.value=e.chamado.detalhamento_solicitacao,u.value=e.chamado.data_solicitacao,v.value=e.chamado.data_entrega,g.value=e.chamado.urgencia,E.value=e.chamado.status,_.value=e.chamado.profissional.id,L.value=e.chamado.etapa,I.value=e.chamado.detalhamento_resolucao):(s.value=completed_fields.assunto||"",m.value=completed_fields.detalhamento_solicitacao||"",u.value=completed_fields.data_solicitacao||"",v.value=completed_fields.data_entrega||"",g.value=completed_fields.urgencia||"",E.value=completed_fields.status||"",_.value=completed_fields.profissional||"",L.value=completed_fields.etapa||"",I.value=completed_fields.detalhamento_resolucao||""),o.appendChild(w),o.appendChild(S),o.appendChild(s),o.appendChild(r),o.appendChild(p),o.appendChild(h),o.appendChild(g),o.appendChild(E),o.appendChild(_),o.appendChild(L),o.appendChild(b)},removeChamadoInputs=()=>{tinyMCE.triggerSave();var e={cliente:"partner-chamado-cliente",marca:"partner-chamado-marca",assunto:"chamado-assunto",detalhamento_solicitacao:"chamado-detalhamento-solicitacao",data_solicitacao:"chamado-data-solicitacao",data_entrega:"chamado-data-entrega",urgencia:"chamado-urgencia",status:"chamado-status",profissional:"chamado-profissional",etapa:"chamado-etapa",detalhamento_resolucao:"chamado-detalhamento-resolucao"};for(const u in e)void 0!==document.getElementById(e[u])&&null!==document.getElementById(e[u])&&(completed_fields[u]=document.getElementById(e[u]).value);const a=document.getElementById("chamado-assunto"),t=(void 0!==a&&null!==a&&a.remove(),document.getElementById("chamado-detalhamento-solicitacao-label")),o=(void 0!==t&&null!==t&&t.remove(),document.getElementById("chamado-data-solicitacao-label")),n=(void 0!==o&&null!==o&&o.remove(),document.getElementById("chamado-data-entrega-label")),d=(void 0!==n&&null!==n&&n.remove(),document.getElementById("chamado-urgencia")),c=(void 0!==d&&null!==d&&d.remove(),document.getElementById("chamado-ponto-focal")),l=(void 0!==c&&null!==c&&c.remove(),document.getElementById("chamado-status")),i=(void 0!==l&&null!==l&&l.remove(),document.getElementById("chamado-profissional")),s=(void 0!==i&&null!==i&&i.remove(),document.getElementById("chamado-etapa")),r=(void 0!==s&&null!==s&&s.remove(),document.getElementById("chamado-detalhamento-resolucao-label")),m=(void 0!==r&&null!==r&&r.remove(),document.getElementById("chamado-button")),p=(void 0!==m&&null!==m&&m.remove(),document.getElementById("chamado-notificacao-label"));void 0!==p&&null!==p&&p.remove(),wp.editor.remove("chamado-detalhamento-solicitacao"),wp.editor.remove("chamado-detalhamento-resolucao")},partner_save_chamado=(e,o,n)=>{const a=new FormData(o);var t=ajax_object.ajax_url,e=(a.append("action","partner_save_chamado"),a.append("post_id",e),a.append("partner_nonce",ajax_object.partner_nonce),{method:"POST",body:a});fetch(t,e).then(e=>e.json()).then(e=>{if(e.success)o.remove(),closePopup(),changeSortSelect();else{const a=document.getElementById("loading");if(void 0!==a&&null!==a){a.remove();const t=document.createElement("div");t.id="error",t.classList.add("error"),t.textContent="Ocorreu um erro ao tentar salvar o chamado.",n.insertBefore(t,n.firstChild)}}}).catch(function(e){console.error(e)})};function partner_ocultar_entregues(e){if(null!=e){const a=document.getElementById("filtro-status");if(void 0!==a&&null!==a)for(const t of a.querySelectorAll('input[type="checkbox"]'))if(parseInt(t.value)!==parseInt(e)){const o=t.parentNode;o.click()}}}function togglePontoFocalDescription(){var e;for(e of document.querySelectorAll(".partner-ponto-focal-atendimento_description")){const t=e.nextElementSibling;if(void 0===t&&null===t)return;if(!t.classList.contains("toggle-descricao"))return;t.getAttribute("data-toggle-status");const o=e;t.addEventListener("click",(e,a)=>{e.preventDefault(),a=t.getAttribute("data-toggle-status");e=o.scrollHeight;"collapsed"===a?(t.setAttribute("data-toggle-status","expanded"),o.setAttribute("data-toggle-status","expanded"),o.style.maxHeight=e+"px"):(t.setAttribute("data-toggle-status","collapsed"),o.setAttribute("data-toggle-status","collapsed"),o.style.maxHeight=0)})}}function setAHrefToOpenInNewTab(){const e=document.querySelector(".chamado-detalhamento-solicitacao-text");if(void 0!==e&&null!==e)for(const t of e.querySelectorAll("a"))t.setAttribute("target","_blank");const a=document.querySelector(".chamado-detalhamento-resolucao-text");if(void 0!==a&&null!==a)for(const o of a.querySelectorAll("a"))o.setAttribute("target","_blank")}const partner_dowload_csv=()=>{const e=document.getElementById("partner-download-csv");void 0!==e&&null!==e&&e.addEventListener("click",e=>{e.preventDefault(),console.log("clicked");const a=new FormData;a.append("action","partner_download_csv");var e=ajax_object.ajax_url,t={method:"POST",body:a};fetch(e,t).then(e=>e.json()).then(e=>{e.success?(console.log("Sucesso",e.success),console.log("file_dir",e.file_dir),console.log("outstream",e.outstream),e=e.file_url,window.open(e)):console.log("Erro")}).catch(function(e){console.log(e)})})};document.addEventListener("DOMContentLoaded",function(){popupCronogramaInit(),popupChamadosInit(),togglePontoFocalDescription(),partner_dowload_csv()});